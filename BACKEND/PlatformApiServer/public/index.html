<html>
<head>
<title>집에 가고 싶다.</title>
</head>
<body>
    <div id="status">
    </div>

    <div id="commentBox">
        <input type = "text" id = "name" size = "40" placeholder="Your name - put shahid"><br><br>
        <textarea cols = "38" rows = "10" id = "comment" placeholder="Add your comment"></textarea><br><br>
        <input type = "button" id = "addComment" value = "Comment"><br>
        <span id = "message"></span>
    </div>
</body>
<style media="screen">
    body {
        padding : 50
    }
    #status {
        width : 250px;
        padding : 10px;
        font-size : 14px;
        margin-left: 20%;
    }
    #commentBox {
        width: 250px;
        padding: 10px;
        margin-top : 10px;
        margin-left : 20%;
    }
</style>
<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>
$(document).ready(function(){
    var socket = io.connect('http://localhost:3457');
    $("#addComment").click(function(event){
        var userId = $("#name").val();
        var userComment = $("#comment").val();
        if(userId === "" || userComment === "") {
            alert("Please fill the form.");
            return;
        }
        
        socket.emit('notiCreate',{uid : userId, contents : userComment});
        socket.on('notiSend',function(msg){       
            let uid = document.cookie.match('uid=([^;]*)')[1];
            if(msg.users_idx === uid) notifyMe(msg.users_idx, msg.contents);
        });
    });
});

function notifyMe(user, message){
    if(!("Notification" in window)){
        alert("해당 브라우저는 desktop notification을 지원하지 않습니다.");
    }else if(Notification.permission === "granted") {
        var options = {
            body: message,
            icon: "resource/logo.png",
            dir: "ltr"
        };

        var notification = new Notification(user + "가 댓글을 작성했습니다", options);
    }else if(Notification.permission !== "denied"){
        Notification.requestPermission(function(permission) {
            if(!('permission' in Notification)){
                Notification.permission = permission;
            }
            if(permission === "granted"){
                var options = {
                    body: message,
                    icon: "resource/logo.png",
                    dir: "ltr"
                };

                var notification = new Notification(user + "가 댓글을 작성했습니다.", options);
            }
        });
    }
}
</script>

</html>
<html>
<head>
    <title>집에가고싶다</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js" type="text/javascript" charset="utf-8"></script>

    <style type="text/css" media="screen">
      body{ background:#FFF;color:#fff;font-size:.9em; }
      .msg{ background:#aaa;padding:.5em; border:1px #000 solid}
      .old{ background-color:#246499;}
      .new{ background-color:#3B9957;}
      .error{ background-color:#992E36;}
    </style>

    <script type="text/javascript" charset="utf-8">
    function addmsg(type, msg){
        $("#messages").append(
            "<div class='msg "+ type +"'>"+ msg +"</div>"
        );
    }

    function long_polling(){
        $.ajax({
            type: "GET",
            url: "/api/noti/list",

            async: true, 
            cache: false,
            timeout:50000, 

            success: function(data){ 
                addmsg("new", data); 
                setTimeout(
                    long_polling, 
                    1000 
                );
            },
            error: function(XMLHttpRequest, textStatus, errorThrown){
                addmsg("error", textStatus + " (" + errorThrown + ")");
                setTimeout(
                    long_polling,
                    15000); 
            }
        });
    };

    $(document).ready(function(){
      long_polling();
    });
    </script>
</head>
<body>
    <div id="messages">
        <div class="msg old">
            BargePoll message requester!
        </div>
    </div>
</body>
</html>